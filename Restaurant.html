<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Restaurant Menu</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    :root {
      --bg: #08080b;
      --text: #fff;
      --text-dim: #aaa;
      --gold: #fbbf24;
      --border: rgba(255, 255, 255, 0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent
    }

    body {
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      touch-action: pan-y;
      overflow: hidden
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 20% 30%, var(--gradient-start), transparent 50%),
        radial-gradient(circle at 80% 70%, var(--gradient-end), transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      padding: 110px 16px 16px;
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      height: 100vh;
      overflow: hidden
    }

    /* شاشة اللودينج */
    .splash {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      z-index: 300;
    }

    .splash.hidden {
      display: none;
    }

    .splash-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--logo-background);
      box-shadow: var(--logo-shadow);
    }

    .splash-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .header {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 32px);
      max-width: 388px;
      z-index: 100;
      padding: 10px 16px;
      border-radius: var(--header-border-radius, 20px);
      background: var(--header-bg);
      box-shadow: var(--header-shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px
    }

    .header-logo {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--logo-background);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      box-shadow: var(--logo-shadow);
      overflow: hidden;
    }

    .header-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .header-title {
      font-size: 18px;
      font-weight: 900;
      background: var(--title-gradient, linear-gradient(135deg, #fff, #ccc));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.03em;
      text-align: center
    }

    .categories {
      height: 100px;
      border-radius: var(--category-border-radius, 24px);
      background: var(--categories-background);
      padding: 0;
      overflow: hidden;
      position: relative;
      perspective: 1000px;
      margin-top: 30px;
      box-shadow: var(--category-shadow);
    }

    .categories .swiper {
      height: 100%;
      overflow: hidden;
      padding: 12px 20px;
    }

    .categories .swiper-wrapper {
      transform-style: preserve-3d;
      height: 100%;
      align-items: center;
    }

    .categories .swiper-slide {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cat-card {
      padding: 8px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      transform-style: preserve-3d;
      width: 100%;
      height: 100%;
      justify-content: center;
      will-change: transform;
    }

    .cat-icon {
      width: 48px;
      height: 48px;
      object-fit: contain;
      filter: var(--icon-shadow, drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3)))
    }

    .cat-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.03em
    }

    .products {
      flex: 1;
      border-radius: var(--products-border-radius, 24px);
      background: var(--products-background);
      padding: 32px 0;
      overflow: hidden;
      position: relative;
      perspective: 1200px;
      box-shadow: var(--products-shadow);
    }

    .products .swiper {
      height: 100%;
      overflow: hidden
    }

    .products .swiper-wrapper {
      align-items: center;
      transform-style: preserve-3d
    }

    .product-card {
      display: flex;
      gap: 23px;
      align-items: center;
      padding: 12px 14px;
      border-radius: var(--card-border-radius, 20px);
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      transform-style: preserve-3d;
      backface-visibility: hidden
    }

    .product-image {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--product-image-shadow, 0 10px 30px rgba(0, 0, 0, 0.8))
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.25s ease
    }

    .product-name {
      font-size: 15px;
      font-weight: 800;
      line-height: 1.3
    }

    .product-desc {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.3;
      -webkit-line-clamp: 2;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden
    }

    .product-price {
      font-size: 18px;
      font-weight: 900;
      background: var(--price-gradient, linear-gradient(135deg, var(--gold), #f59e0b));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--modal-overlay, rgba(0, 0, 0, 0.85));
      z-index: 200;
      align-items: center;
      justify-content: center;
      padding: 20px
    }

    .modal.active {
      display: flex
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    .modal-content {
      background: var(--modal-bg, rgba(16, 16, 20, 0.95));
      border-radius: 28px;
      width: 100%;
      max-width: 400px;
      padding: 24px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0
      }

      to {
        transform: scale(1);
        opacity: 1
      }
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--modal-close-bg, rgba(255, 255, 255, 0.1));
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s
    }

    .modal-close:active {
      background: var(--modal-close-active, rgba(255, 255, 255, 0.2))
    }

    .modal-header {
      display: flex;
      gap: 16px;
      margin-bottom: 23px
    }

    .modal-image {
      width: 100px;
      height: 100px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--modal-image-shadow, 0 10px 40px rgba(0, 0, 0, 0.8))
    }

    .modal-image img {
      width: 100%;
      height: 100%;
      object-fit: cover
    }

    .modal-title {
      font-size: 22px;
      font-weight: 900;
      margin: 12px 0 8px
    }

    .modal-rating {
      color: var(--gold);
      font-size: 16px;
      margin-bottom: 8px
    }

    .modal-price {
      font-size: 32px;
      font-weight: 900;
      background: var(--price-gradient, linear-gradient(135deg, var(--gold), #f59e0b));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .modal-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0
    }

    .info-card {
      background: var(--info-card-bg, rgba(255, 255, 255, 0.06));
      border: 1px solid var(--info-card-border, rgba(255, 255, 255, 0.12));
      border-radius: 14px;
      padding: 14px;
      text-align: center
    }

    .info-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-bottom: 6px
    }

    .info-value {
      font-size: 17px;
      font-weight: 800
    }

    .modal-section-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-dim);
      margin: 20px 0 12px;
      text-transform: uppercase
    }

    .ingredients-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px
    }

    .ingredient-tag {
      padding: 8px 14px;
      background: var(--ingredient-tag-bg, rgba(255, 255, 255, 0.08));
      border: 1px solid var(--ingredient-tag-border, rgba(255, 255, 255, 0.14));
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600
    }

    .skeleton {
      background: var(--skeleton-bg, linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%));
      background-size: 200% 100%;
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0
      }

      100% {
        background-position: -200% 0
      }
    }

    .skeleton-product {
      display: flex;
      gap: 12px;
      padding: 12px 14px;
      margin: 8px 0
    }

    .skeleton-img {
      width: 80px;
      height: 80px;
      border-radius: 16px
    }

    .skeleton-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: center
    }

    .skeleton-line {
      height: 14px;
      border-radius: 4px
    }

    .skeleton-line.w-60 {
      width: 60%
    }

    .skeleton-line.w-40 {
      width: 40%
    }

    @media (max-height:640px) {
      .app {
        padding: 100px 16px 16px
      }

      .header-title {
        font-size: 20px
      }

      .categories {
        height: 90px
      }

      .cat-icon {
        width: 42px;
        height: 42px
      }
    }

    @media (max-width: 480px) {
      .products {
        padding: 36px 0;
      }

      .product-card {
        padding: 14px 16px;
        gap: 14px;
      }
    }
  </style>
</head>

<body>
  <!-- شاشة اللودينج باللوجو -->
  <div class="splash" id="splash">
    <div class="splash-logo" id="splashLogo"></div>
  </div>

  <div class="app">
    <header class="header">
      <div class="header-logo" id="logo"></div>
      <div class="header-title" id="restaurantName">Loading...</div>
    </header>

    <div class="categories">
      <div class="swiper" id="catSwiper">
        <div class="swiper-wrapper" id="catWrapper"></div>
      </div>
    </div>

    <div class="products">
      <div class="swiper" id="prodSwiper">
        <div class="swiper-wrapper" id="prodWrapper">
          <div class="swiper-slide">
            <div class="skeleton-product">
              <div class="skeleton skeleton-img"></div>
              <div class="skeleton-text">
                <div class="skeleton skeleton-line w-60"></div>
                <div class="skeleton skeleton-line w-40"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">×</button>
      <div class="modal-header">
        <div class="modal-image"><img id="modalImg" src="" alt="" decoding="async"></div>
        <div style="flex:1">
          <div class="modal-title" id="modalTitle">Product</div>
          <div class="modal-rating">⭐ <span id="modalRating">4.8</span></div>
          <div class="modal-price" id="modalPrice">$0.00</div>
        </div>
      </div>
      <div class="modal-info">
        <div class="info-card">
          <div class="info-label">Calories</div>
          <div class="info-value" id="modalCalories">—</div>
        </div>
        <div class="info-card">
          <div class="info-label">Prep Time</div>
          <div class="info-value" id="modalTime">—</div>
        </div>
      </div>
      <div class="modal-section-title">Description</div>
      <p id="modalDesc" style="color:var(--text-dim);line-height:1.6;font-size:14px"></p>
      <div class="modal-section-title">Ingredients</div>
      <div class="ingredients-list" id="modalIngredients"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    let audioCtx, lastFeedback = 0, restaurant, catSwiper, prodSwiper, currentCat = 0;
    const catWrapper = document.getElementById('catWrapper'),
      prodWrapper = document.getElementById('prodWrapper'),
      modal = document.getElementById('modal');
    const splash = document.getElementById('splash'),
      splashLogo = document.getElementById('splashLogo');

    const docEl = document.documentElement;
    let activeCardBg = 'rgba(255,255,255,0.1)';
    let activeCardShadow = '0 20px 60px rgba(0,0,0,0.95),0 0 0 1px rgba(255,255,255,0.12)';
    // كشف تقريبي للأجهزة الضعيفة
    const IS_LOW_END = (function () {
      const cores = navigator.hardwareConcurrency || 2;
      const mem = navigator.deviceMemory || 4; // مش مدعومة في كل المتصفحات
      // نعتبر الجهاز ضعيف لو عدد الأنوية قليل والرام قليلة
      if (cores <= 4 && mem <= 2) return true;
      return false;
    })();


    function updateActiveCardStyles() {
      const cs = getComputedStyle(docEl);
      activeCardBg = cs.getPropertyValue('--active-card-background') || activeCardBg;
      activeCardShadow = cs.getPropertyValue('--active-card-shadow') || activeCardShadow;
    }

    function hideSplash() {
      if (splash) splash.classList.add('hidden');
    }

    let apply3DQueued = false;
    let last3DArgs = null;

    function scheduleApply3D(swiper, isCat) {
      if (!swiper || !swiper.slides || swiper.slides.length === 0) return;
      last3DArgs = { swiper, isCat };
      if (apply3DQueued) return;
      apply3DQueued = true;
      requestAnimationFrame(() => {
        apply3DQueued = false;
        if (!last3DArgs) return;
        apply3D(last3DArgs.swiper, last3DArgs.isCat);
      });
    }

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function playSound() {
      if (!audioCtx) {
        initAudio();
      }

      if (audioCtx && audioCtx.state === 'suspended') {
        audioCtx.resume();
      }

      if (!audioCtx || audioCtx.state !== 'running') return;

      const now = performance.now();
      if (now - lastFeedback < 50) return;
      lastFeedback = now;

      try {
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(1519.91, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.01);
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.012, audioCtx.currentTime + 0.005);
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.025);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime);
        osc.stop(audioCtx.currentTime + 0.025);

        if (navigator.vibrate) navigator.vibrate(2);
      } catch (e) {
        console.error('Audio error:', e);
      }
    }

    function showModal(prod) {
      document.getElementById('modalImg').src = prod.image;
      document.getElementById('modalTitle').textContent = prod.name;
      document.getElementById('modalPrice').textContent = `${prod.price.toFixed(2)} EGP`;
      document.getElementById('modalRating').textContent = prod.rating || '—';
      document.getElementById('modalCalories').textContent = prod.calories || '—';
      document.getElementById('modalTime').textContent = prod.time || '—';
      document.getElementById('modalDesc').textContent = prod.description || '';
      const list = document.getElementById('modalIngredients');
      list.innerHTML = '';
      (prod.ingredients || []).forEach(i => {
        const tag = document.createElement('span');
        tag.className = 'ingredient-tag';
        tag.textContent = i;
        list.appendChild(tag);
      });
      modal.classList.add('active');
    }

    function hideModal() { modal.classList.remove('active') }

    document.getElementById('modalClose').onclick = hideModal;
    modal.onclick = e => { if (e.target === modal) hideModal() };

    const params = new URLSearchParams(location.search), r = params.get("r") || "1";

    function createCat(cat) {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `<div class="cat-card"><img src="${cat.icon}" alt="${cat.name}" class="cat-icon"><div class="cat-name">${cat.name}</div></div>`;
      catWrapper.appendChild(slide);
    }

    function createProd(prod, index) {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `<div class="product-card" data-index="${index}">
        <div class="product-image"><img src="${prod.image}" alt="${prod.name}" loading="lazy" decoding="async"></div>
        <div style="flex:1">
          <div class="product-name">${prod.name}</div>
          <div class="product-desc">${prod.description}</div>
        </div>
        <div class="product-price">${prod.price.toFixed(2)} EGP</div>
      </div>`;
      prodWrapper.appendChild(slide);
    }

    function apply3D(swiper, isCat) {
      if (!swiper || !swiper.slides || swiper.slides.length === 0) return;
      const slides = swiper.slides;
      const active = swiper.activeIndex;
      const total = slides.length;

      slides.forEach((slide, i) => {
        let diff = i - active;

        if (diff > total / 2) { diff -= total }
        else if (diff < -total / 2) { diff += total }

        const abs = Math.abs(diff);
        const el = slide.querySelector(isCat ? '.cat-card' : '.product-card');
        if (!el) return;

        let rot = diff * 20;
        let z = -abs * 40;
        let x = diff * 4;
        let s = 1 - abs * 0.14;
        let o = 1 - abs * 0.32;
        let br = 1 - abs * 0.16;

        if (abs > 1.9) {
          o = Math.max(0, 1 - (abs - 1.9) * 3);
          s = Math.max(0.75, 1 - (abs - 1.9) * 0.8);
          z = -abs * 38;
          slide.style.visibility = o > 0.1 ? 'visible' : 'hidden';
        } else {
          slide.style.visibility = 'visible';
          slide.style.pointerEvents = 'auto';
        }

        el.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${rot}deg) scale(${s})`;
        el.style.opacity = o;
        el.style.filter = `brightness(${br})`;

        if (abs === 0) {
          el.style.background = activeCardBg;
          el.style.boxShadow = activeCardShadow;
          if (!isCat) {
            const img = el.querySelector('.product-image img');
            if (img) img.style.transform = 'scale(1.12)';
          }
        } else {
          el.style.background = 'transparent';
          el.style.boxShadow = 'none';
          if (!isCat) {
            const img = el.querySelector('.product-image img');
            if (img) img.style.transform = 'scale(1)';
          }
        }
      });
    }

    function loadCategory() {
      const cat = restaurant.categories[currentCat];
      prodWrapper.innerHTML = '';

      const repeatTimes = IS_LOW_END ? 6 : 15;
      for (let i = 0; i < repeatTimes; i++) {
        cat.products.forEach((prod, idx) => createProd(prod, idx));
      }

      if (prodSwiper) prodSwiper.destroy(true, true);

      prodSwiper = new Swiper('#prodSwiper', {
        direction: 'vertical',
        slidesPerView: 5,
        centeredSlides: true,
        spaceBetween: 20,
        loop: true,
        loopAdditionalSlides: IS_LOW_END ? 8 : 20,
        loopedSlides: cat.products.length * repeatTimes,
        speed: 350,
        allowTouchMove: true,
        shortSwipes: true,
        longSwipes: true,
        longSwipesRatio: 0.3,
        grabCursor: true,
        touchRatio: 0.8,
        threshold: 9,
        resistance: false,
        watchSlidesProgress: true,
        slideToClickedSlide: false,
        on: {
          init() { scheduleApply3D(this, false); },
          slideChange() {
            playSound();
            scheduleApply3D(this, false);
          },
          progress() { scheduleApply3D(this, false); },
          setTranslate() { scheduleApply3D(this, false); },
          tap(s, e) {
            const sl = e.target.closest('.swiper-slide');
            if (!sl) return;
            const card = sl.querySelector('.product-card');
            if (!card) return;
            if (sl.classList.contains('swiper-slide-active')) {
              const idxAttr = card.getAttribute('data-index');
              if (idxAttr == null) return;
              const prodIndex = +idxAttr;
              const cat = restaurant && restaurant.categories && restaurant.categories[currentCat];
              if (!cat || !cat.products || !cat.products[prodIndex]) return;
              const prod = cat.products[prodIndex];
              showModal(prod);
            } else {
              const idx = Array.from(s.slides).indexOf(sl);
              if (idx !== -1) s.slideTo(idx, 300);
            }
          }
        }

      });
     setTimeout(() => {
  scheduleApply3D(prodSwiper, false);
}, 50);
    }

    function loadRestaurant(data) {
      restaurant = data;
      const t = restaurant.theme;
      for (let k in t) {
        const prop = k.replace(/([A-Z])/g, '-$1').toLowerCase();
        document.documentElement.style.setProperty(`--${prop}`, t[k]);
      }
      updateActiveCardStyles();

      if (t.font && t.font !== 'Inter') {
        const link = document.createElement('link');
        link.href = `https://fonts.googleapis.com/css2?family=${t.font.replace(' ', '+')}:wght@400;700;900&display=swap`;
        link.rel = 'stylesheet';
        document.head.appendChild(link);
        document.body.style.fontFamily = t.font + ',sans-serif';
      }
      const logoEl = document.getElementById('logo');
      if (restaurant.logoImage) {
        logoEl.innerHTML = `<img src="${restaurant.logoImage}" alt="${restaurant.name}" decoding="async">`;
      } else {
        logoEl.textContent = restaurant.logo;
      }
      document.getElementById('restaurantName').textContent = restaurant.name;

      // وضع نفس اللوجو في شاشة اللودينج
      if (splashLogo) {
        if (restaurant.logoImage) {
          splashLogo.innerHTML =
            `<img src="${restaurant.logoImage}" alt="${restaurant.name}" decoding="async">`;
        } else {
          splashLogo.textContent = restaurant.logo || '';
        }
      }

      const originalCats = [...restaurant.categories];
      const repeatCount = IS_LOW_END ? 4 : 8;

      catWrapper.innerHTML = '';

      for (let i = 0; i < repeatCount; i++) {
        originalCats.forEach(cat => createCat(cat));
      }

      if (catSwiper) catSwiper.destroy(true, true);

      catSwiper = new Swiper('#catSwiper', {
        slidesPerView: 5,
        centeredSlides: true,
        spaceBetween: 10,
        loop: true,
        loopedSlides: originalCats.length * repeatCount,
        loopAdditionalSlides: IS_LOW_END ? 8 : 20,
        speed: 300,
        grabCursor: true,
        touchRatio: 1,
        resistanceRatio: 0,
        watchSlidesProgress: true,
        slideToClickedSlide: true,
        freeMode: false,
        threshold: 8,
        on: {
          init() { scheduleApply3D(this, true); },
          slideChange() {
            const newCat = this.realIndex % originalCats.length;
            if (newCat !== currentCat) {
              currentCat = newCat;
              playSound();
              loadCategory();
            }
            scheduleApply3D(this, true);
          },
          progress() { scheduleApply3D(this, true); },
          setTranslate() { scheduleApply3D(this, true); },
          tap(s, e) {
            const sl = e.target.closest('.swiper-slide');
            if (!sl || sl.classList.contains('swiper-slide-active')) return;
            const idx = Array.from(s.slides).indexOf(sl);
            if (idx !== -1) s.slideTo(idx, 300);
          }
        }
      });
     setTimeout(() => {
  scheduleApply3D(catSwiper, true);
}, 50);

      loadCategory();
      hideSplash();

      document.addEventListener('click', initAudio, { once: true, passive: true });
      document.addEventListener('touchstart', initAudio, { once: true, passive: true });

      document.addEventListener('visibilitychange', () => {
        if (!document.hidden && audioCtx) {
          audioCtx.resume();
        }
      });
    }

    fetch(`restaurant_${r}.json`)
      .then(res => { if (!res.ok) throw new Error('Not found'); return res.json() })
      .then(loadRestaurant)
      .catch(() => alert('Restaurant not found!'));
  </script>
</body>

</html>
