<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Restaurant Menu</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    :root {
      --bg: #08080b;
      --text: #fff;
      --text-dim: #aaa;
      --gold: #fbbf24;
      --border: rgba(255, 255, 255, 0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      touch-action: pan-y;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 20% 30%, var(--gradient-start, rgba(99, 102, 241, 0.15)), transparent 50%), radial-gradient(circle at 80% 70%, var(--gradient-end, rgba(168, 85, 247, 0.12)), transparent 50%);
      pointer-events: none;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      padding: 82px 16px 16px;
      position: relative;
      z-index: 1;
      border: 1px solid var(--border);
      border-radius: 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .header {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 32px);
      max-width: 388px;
      z-index: 100;
      padding: 14px 18px;
      border-radius: 22px;
      background: var(--header-bg, rgba(16, 16, 20, 0.95));
      backdrop-filter: blur(40px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-logo {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(135deg, #6366f1, #a855f7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .header-title {
      font-size: 17px;
      font-weight: 900;
      background: linear-gradient(135deg, #fff, #ccc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .categories {
      margin-bottom: 28px;
      border-radius: 24px;
      background: var(--products-bg, rgba(16, 16, 20, 0.6));
      backdrop-filter: blur(20px);
      padding: 10px 0;
      overflow: hidden;
      z-index: 1;
    }

    .cat-card {
      padding: 12px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      transition: transform 0.15s ease-out, opacity 0.15s ease-out, filter 0.15s ease-out;
      will-change: transform, opacity;
    }

    .cat-emoji {
      font-size: 38px;
    }

    .cat-name {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    .swiper-slide:not(.swiper-slide-active) .cat-card {
      opacity: 0.5;
      filter: blur(0.5px);
      transform: scale(0.9);
    }

    .swiper-slide-active .cat-card {
      opacity: 1;
      filter: blur(0);
      transform: scale(1.1);
    }

    .products {
      height: 380px;
      min-height: 340px;
      margin-bottom: 16px;
      border-radius: 24px;
      background: var(--products-bg, rgba(16, 16, 20, 0.6));
      backdrop-filter: blur(20px);
      padding: 16px 0;
      overflow: hidden;
      z-index: 1;
    }

    .products .swiper {
      height: 100%;
      overflow: hidden;
    }

    .products .swiper-wrapper {
      align-items: center;
    }

    .product-card {
      display: flex;
      gap: 14px;
      align-items: center;
      padding: 12px 12px;
      border-radius: 22px;
      transition: transform 0.12s ease-out, opacity 0.12s ease-out, filter 0.12s ease-out, background 0.12s ease-out;
      will-change: transform, opacity;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    .product-image {
      width: 88px;
      height: 88px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.12s ease-out;
      will-change: transform;
      transform: translateZ(0);
    }

    .product-name {
      font-size: 16px;
      font-weight: 800;
    }

    .product-desc {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.4;
      -webkit-line-clamp: 2;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-price {
      font-size: 19px;
      font-weight: 900;
      background: linear-gradient(135deg, var(--gold), #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .swiper-slide:not(.swiper-slide-active) .product-card {
      opacity: 0.45;
      filter: blur(1px) brightness(0.7);
      transform: scale(0.92) translateZ(0);
    }

    .swiper-slide-active .product-card {
      background: rgba(255, 255, 255, 0.09);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.95), 0 0 0 1px rgba(255, 255, 255, 0.1);
      transform: scale(1) translateZ(0);
      filter: blur(0);
    }

    .swiper-slide-active .product-image img {
      transform: scale(1.15) translateZ(0);
    }

    .details-section {
      border-radius: 24px;
      background: var(--details-bg, rgba(16, 16, 20, 0.75));
      backdrop-filter: blur(30px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      padding: 18px;
      position: relative;
    }

    .details-section::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--details-gradient-1, rgba(99, 102, 241, 0.08)), transparent, var(--details-gradient-2, rgba(168, 85, 247, 0.08)));
      pointer-events: none;
      border-radius: 24px;
    }

    .details-header {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 18px;
      position: relative;
      z-index: 1;
    }

    .details-image {
      width: 85px;
      height: 85px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8);
    }

    .details-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .details-title {
      font-size: 19px;
      font-weight: 900;
      margin: 8px 0 4px;
    }

    .details-price-large {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, var(--gold), #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .details-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin: 18px 0;
      position: relative;
      z-index: 1;
    }

    .info-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }

    .info-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    .info-value {
      font-size: 16px;
      font-weight: 800;
      margin-top: 4px;
    }

    .ingredients-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-dim);
      margin: 16px 0 10px;
      text-transform: uppercase;
      position: relative;
      z-index: 1;
    }

    .ingredients-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .ingredient-tag {
      padding: 8px 14px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 10px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="header-logo" id="logo">⏳</div>
      <div>
        <div class="header-title" id="restaurantName">Loading...</div>
        <div style="font-size:11px;color:#777;margin-top:2px;">Premium Dining Experience</div>
      </div>
    </header>

    <div class="categories">
      <div class="swiper" id="catSwiper">
        <div class="swiper-wrapper" id="catWrapper"></div>
      </div>
    </div>

    <div class="products">
      <div class="swiper" id="prodSwiper">
        <div class="swiper-wrapper" id="prodWrapper"></div>
      </div>
    </div>

    <section class="details-section">
      <div class="details-header">
        <div class="details-image"><img id="detailsImg" src="" alt=""></div>
        <div style="flex:1">
          <div style="padding:4px 12px;background:rgba(16,185,129,0.3);border:1px solid rgba(16,185,129,0.5);border-radius:8px;display:inline-block;font-size:10px;font-weight:800;color:#10b981;">MOST ORDERED</div>
          <h3 class="details-title" id="detailsTitle">Loading...</h3>
          <div style="color:var(--gold);font-size:15px;">⭐ <span id="detailsRating">4.8</span> <span style="color:#777">(124)</span></div>
        </div>
        <div class="details-price-large" id="detailsPrice">$0.00</div>
      </div>
      <div class="details-info">
        <div class="info-card">
          <div class="info-label">Calories</div>
          <div class="info-value" id="detailsCalories">—</div>
        </div>
        <div class="info-card">
          <div class="info-label">Prep Time</div>
          <div class="info-value" id="detailsTime">—</div>
        </div>
      </div>
      <div class="ingredients-title">Ingredients</div>
      <div class="ingredients-list" id="ingredientsList"></div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    let audioContext;
    
    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playFeedback() {
      initAudio();
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      
      osc.connect(gain);
      gain.connect(audioContext.destination);
      
      osc.frequency.value = 800;
      osc.type = 'sine';
      
      gain.gain.setValueAtTime(0.03, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.015);
      
      osc.start(audioContext.currentTime);
      osc.stop(audioContext.currentTime + 0.015);
      
      if (navigator.vibrate) navigator.vibrate(3);
    }

    const params = new URLSearchParams(window.location.search);
    const r = params.get("r") || "1";

    let restaurant, catSwiper, prodSwiper, currentCatIndex = 0;
    let updateTimeout = null;
    let isScrolling = false;
    const catWrapper = document.getElementById('catWrapper');
    const prodWrapper = document.getElementById('prodWrapper');

    function adjustLayout() {
      const header = document.querySelector('.header');
      const categories = document.querySelector('.categories');
      const details = document.querySelector('.details-section');
      const products = document.querySelector('.products');
      const appEl = document.querySelector('.app');
      const h = window.innerHeight;
      const headerH = header?.getBoundingClientRect().height || 0;
      const catH = categories?.getBoundingClientRect().height || 0;
      const detailsH = details?.getBoundingClientRect().height || 0;
      const topPad = appEl ? parseFloat(getComputedStyle(appEl).paddingTop) : 0;
      const bottomPad = appEl ? parseFloat(getComputedStyle(appEl).paddingBottom) : 0;
      const space = 8;
      let target = h - headerH - catH - detailsH - topPad - bottomPad - space;
      if (!isFinite(target)) target = 380;
      target = Math.max(280, Math.min(420, target));
      if (products) products.style.height = target + 'px';
    }

    function createCat(cat) {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `<div class="cat-card"><div class="cat-emoji">${cat.emoji}</div><div class="cat-name">${cat.name}</div></div>`;
      catWrapper.appendChild(slide);
    }

    function createProd(prod) {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `
    <div class="product-card">
      <div class="product-image"><img src="${prod.image}" alt="${prod.name}" loading="lazy"></div>
      <div style="flex:1">
        <div class="product-name">${prod.name}</div>
        <div class="product-desc">${prod.description}</div>
      </div>
      <div class="product-price">$${prod.price.toFixed(2)}</div>
    </div>`;
      prodWrapper.appendChild(slide);
    }

    function updateDetails(prod) {
      if (isScrolling) return;
      
      document.getElementById('detailsImg').src = prod.image;
      document.getElementById('detailsTitle').textContent = prod.name;
      document.getElementById('detailsPrice').textContent = `$${prod.price.toFixed(2)}`;
      document.getElementById('detailsRating').textContent = prod.rating || '—';
      document.getElementById('detailsCalories').textContent = prod.calories || '—';
      document.getElementById('detailsTime').textContent = prod.time || '—';
      const list = document.getElementById('ingredientsList');
      list.innerHTML = '';
      (prod.ingredients || []).forEach(i => {
        const tag = document.createElement('span');
        tag.className = 'ingredient-tag';
        tag.textContent = i;
        list.appendChild(tag);
      });
    }

    function scheduleUpdate(prod) {
      if (updateTimeout) clearTimeout(updateTimeout);
      updateTimeout = setTimeout(() => {
        updateDetails(prod);
      }, 100);
    }

    function loadRestaurant(data) {
      restaurant = data;
      
      const t = restaurant.theme;
      document.documentElement.style.setProperty('--bg', t.bg);
      document.documentElement.style.setProperty('--text', t.text);
      document.documentElement.style.setProperty('--text-dim', t.textDim);
      document.documentElement.style.setProperty('--gold', t.gold);
      document.documentElement.style.setProperty('--border', t.border);
      document.documentElement.style.setProperty('--gradient-start', t.gradientStart);
      document.documentElement.style.setProperty('--gradient-end', t.gradientEnd);
      document.documentElement.style.setProperty('--details-gradient-1', t.detailsGradient1);
      document.documentElement.style.setProperty('--details-gradient-2', t.detailsGradient2);
      document.documentElement.style.setProperty('--products-bg', t.productsBackground);
      document.documentElement.style.setProperty('--header-bg', t.headerBackground);
      document.documentElement.style.setProperty('--details-bg', t.detailsBackground);
      
      document.body.style.fontFamily = t.font + ', sans-serif';

      if (t.font !== 'Inter') {
        const link = document.createElement('link');
        link.href = `https://fonts.googleapis.com/css2?family=${t.font.replace(' ', '+')}:wght@400;500;600;700;800;900&display=swap`;
        link.rel = 'stylesheet';
        document.head.appendChild(link);
      }

      document.getElementById('logo').textContent = restaurant.logo;
      document.getElementById('restaurantName').textContent = restaurant.name;

      restaurant.categories.forEach(createCat);
      
      catSwiper = new Swiper('#catSwiper', {
        slidesPerView: 5,
        centeredSlides: true,
        spaceBetween: 20,
        loop: true,
        freeMode: {
          enabled: true,
          sticky: true,
          momentum: true,
          momentumRatio: 0.25,
          momentumVelocityRatio: 0.25
        },
        speed: 180,
        grabCursor: true,
        touchRatio: 1.5,
        threshold: 3,
        passiveListeners: true,
        on: { 
          slideChange() { 
            currentCatIndex = this.realIndex ?? this.activeIndex ?? 0;
            playFeedback();
            loadCategory();
          }
        }
      });

      function loadCategory() {
        const cat = restaurant.categories[currentCatIndex];
        prodWrapper.innerHTML = '';
        cat.products.forEach(createProd);

        if (prodSwiper) prodSwiper.destroy(true, true);
        
        prodSwiper = new Swiper('#prodSwiper', {
          direction: 'vertical',
          slidesPerView: 3,
          centeredSlides: true,
          spaceBetween: 22,
          loop: cat.products.length >= 4,
          freeMode: {
            enabled: true,
            sticky: true,
            momentum: true,
            momentumRatio: 0.25,
            momentumVelocityRatio: 0.25,
            minimumVelocity: 0.02
          },
          speed: 180,
          grabCursor: true,
          touchRatio: 1.5,
          threshold: 3,
          passiveListeners: true,
          on: {
            touchStart() {
              isScrolling = true;
            },
            touchEnd() {
              setTimeout(() => {
                isScrolling = false;
                const idx = this.realIndex ?? this.activeIndex ?? 0;
                updateDetails(cat.products[idx]);
              }, 150);
            },
            slideChange() {
              const idx = this.realIndex ?? this.activeIndex ?? 0;
              playFeedback();
              scheduleUpdate(cat.products[idx]);
            }
          }
        });
        adjustLayout();
      }

      loadCategory();
      updateDetails(restaurant.categories[0].products[0]);
      adjustLayout();
      
      if ('ResizeObserver' in window) {
        const ro = new ResizeObserver(() => adjustLayout());
        const detailsEl = document.querySelector('.details-section');
        if (detailsEl) ro.observe(detailsEl);
      }
      window.addEventListener('resize', adjustLayout, { passive: true });
      
      document.addEventListener('touchstart', initAudio, { once: true, passive: true });
    }

    fetch(`restaurant_${r}.json`)
      .then(res => {
        if (!res.ok) throw new Error('Restaurant not found');
        return res.json();
      })
      .then(loadRestaurant)
      .catch(err => {
        console.error(err);
        alert('Restaurant not found!');
      });
  </script>
</body>
</html>
